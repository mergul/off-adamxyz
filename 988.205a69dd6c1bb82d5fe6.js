(self.webpackChunkadamxyz=self.webpackChunkadamxyz||[]).push([[988],{6988:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CameraModule:()=>$});var i=n(1116),s=n(3464),r=n(6304),o=n(8512),a=n(5959),c=n(9342),l=n(8470),h=n(6673),d=n(5686),g=n(6882);class u{constructor(e){this.resultSelector=e}call(e,t){return t.subscribe(new p(e,this.resultSelector))}}class p extends h.L{constructor(e,t,n=Object.create(null)){super(e),this.resultSelector=t,this.iterators=[],this.active=0,this.resultSelector="function"==typeof t?t:void 0}_next(e){const t=this.iterators;(0,l.k)(e)?t.push(new f(e)):t.push("function"==typeof e[d.hZ]?new m(e[d.hZ]()):new v(this.destination,this,e))}_complete(){const e=this.iterators,t=e.length;if(this.unsubscribe(),0!==t){this.active=t;for(let n=0;n<t;n++){let t=e[n];t.stillUnsubscribed?this.destination.add(t.subscribe()):this.active--}}else this.destination.complete()}notifyInactive(){this.active--,0===this.active&&this.destination.complete()}checkIterators(){const e=this.iterators,t=e.length,n=this.destination;for(let r=0;r<t;r++){let t=e[r];if("function"==typeof t.hasValue&&!t.hasValue())return}let i=!1;const s=[];for(let r=0;r<t;r++){let t=e[r],o=t.next();if(t.hasCompleted()&&(i=!0),o.done)return void n.complete();s.push(o.value)}this.resultSelector?this._tryresultSelector(s):n.next(s),i&&n.complete()}_tryresultSelector(e){let t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}class m{constructor(e){this.iterator=e,this.nextResult=e.next()}hasValue(){return!0}next(){const e=this.nextResult;return this.nextResult=this.iterator.next(),e}hasCompleted(){const e=this.nextResult;return Boolean(e&&e.done)}}class f{constructor(e){this.array=e,this.index=0,this.length=0,this.length=e.length}[d.hZ](){return this}next(e){const t=this.index++;return t<this.length?{value:this.array[t],done:!1}:{value:null,done:!0}}hasValue(){return this.array.length>this.index}hasCompleted(){return this.array.length===this.index}}class v extends g.Ds{constructor(e,t,n){super(e),this.parent=t,this.observable=n,this.stillUnsubscribed=!0,this.buffer=[],this.isComplete=!1}[d.hZ](){return this}next(){const e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}}hasValue(){return this.buffer.length>0}hasCompleted(){return 0===this.buffer.length&&this.isComplete}notifyComplete(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()}notifyNext(e){this.buffer.push(e),this.parent.checkIterators()}subscribe(){return(0,g.ft)(this.observable,new g.IY(this))}}var x=n(9764),C=n(1041);class S{constructor(e,t,n,i,s){this.messageListeners=[],this.sendToServer=e=>{const t=JSON.stringify(e);this.connection.send(t)},this.connectToSocket=()=>{this.connection=new WebSocket(`wss://${this.socketURL}`),this.connection.onopen=()=>(this.username&&this.sendToServer({event:"id",data:this.username,room:this.room}),this.onOpen),this.connection.onmessage=e=>{const t=JSON.parse(e.data);this.messageListeners.forEach(e=>e(t)),console.log(e.data)}},this.addMsgListener=e=>(this.messageListeners=[...this.messageListeners,e],()=>{this.messageListeners=this.messageListeners.filter(t=>t!==e)}),this.onOpen=t,this.socketURL=e,this.messageListeners=[n],this.username=i,this.room=s,this.connectToSocket()}}var b=n(9996),y=n(5416),w=n(5366),L=n(9823),E=n(8622),Z=n(7444),T=n(3589),_=n(3070),M=n(3841),O=n(6174),R=n(246),k=n(7064);const U=["canvas"],A=["soundCanvas"],D=["startButton"],B=["localVideo"],q=["remoteVideo"],P=["publicChatBox"],I=["textBox"],N=["privateChatBox"],H=["speechTextBox"];function j(e,t){if(1&e){const e=w.EpF();w.TgZ(0,"mat-option",38),w.NdJ("click",function(){const t=w.CHM(e).$implicit;return w.oxw().onSelectLanguage(t)}),w._uU(1),w.qZA()}if(2&e){const e=t.$implicit;w.Q6J("value",e),w.xp6(1),w.hij(" ",e," ")}}function z(e,t){if(1&e){const e=w.EpF();w.TgZ(0,"mat-option",38),w.NdJ("click",function(){const t=w.CHM(e).$implicit;return w.oxw().onSelectTargetLanguage(t)}),w._uU(1),w.qZA()}if(2&e){const e=t.$implicit;w.Q6J("value",e),w.xp6(1),w.hij(" ",e," ")}}function J(e,t){if(1&e&&(w.TgZ(0,"mat-option",39),w._uU(1),w.qZA()),2&e){const e=t.$implicit;w.Q6J("value",e),w.xp6(1),w.hij(" ",e.deviceId," ")}}function V(e,t){if(1&e){const e=w.EpF();w.TgZ(0,"li"),w.TgZ(1,"span"),w._uU(2),w.qZA(),w.TgZ(3,"button",40),w.NdJ("click",function(){const t=w.CHM(e).$implicit;return w.oxw().callUser(t)}),w._uU(4," Call"),w.qZA(),w.TgZ(5,"button",40),w.NdJ("click",function(){const t=w.CHM(e).$implicit;return w.oxw().stopSample(t)}),w._uU(6,"Hang Up"),w.qZA(),w.TgZ(7,"button",40),w.NdJ("click",function(){const t=w.CHM(e).$implicit;return w.oxw().sendData(t)}),w._uU(8,"Private Msg"),w.qZA(),w.qZA()}if(2&e){const e=t.$implicit;w.xp6(2),w.Oqu(e)}}function F(e,t){if(1&e){const e=w.EpF();w.TgZ(0,"div",41),w.TgZ(1,"button",42),w.NdJ("click",function(){return w.CHM(e),w.oxw().capture()}),w._uU(2,"Capture Image"),w.qZA(),w.qZA()}}let G=(()=>{class e{constructor(e,t,n,i,s,l,h){var d=this;this.reactive=e,this.renderer=t,this.scriptService=n,this.speechService=i,this.zone=s,this._snackBar=l,this._document=h,this.currentLanguage="en",this.targetLanguage="tr",this.videoWidth=0,this.videoHeight=0,this.constraints={video:{facingMode:"environment",width:{ideal:760},height:{ideal:480},frameRate:{ideal:20,max:30}},audio:{sampleSize:16,channelCount:2,echoCancellation:!1}},this.animalControl=new C.NI("",[C.kI.required]),this.chunks=[],this.isRecording=!1,this.clones=[],this.startButtonDisabled=!1,this.callButtonDisabled=!0,this.hangupButtonDisabled=!0,this.chatBoxDisabled=!0,this.remoteStreamMap=new Map,this.peerLStream=new Map,this.peerRStream=new Map,this.mediaMap=new Map,this.hangedUps=[],this.offerOptions={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.refreshOfferOptions={offerToReceiveAudio:!0,offerToReceiveVideo:!0,iceRestart:!0},this.caSubject=new o.X({}),this.peerList=new Map,this.bandwidth=30,this.dataChannelList=new Map,this.makingOffer=!1,this.recognizing=!1,this.languages=["en","es","de","fr","tr"],this.onDestroy=new a.xQ,this.joinedUser="",this.loggedUser="",this.isNew="",this.yostream=!1,this.stopSample=function(){var e=(0,r.Z)(function*(e){d.startButtonDisabled=!1});return function(t){return e.apply(this,arguments)}}(),this.onSignalingMessage=function(){var e=(0,r.Z)(function*(e){let t="";const n=new Date(e.date).toLocaleTimeString();switch(e.event){case"id":d.clientID||(d.clientID=e.id),d.userList=e.users,d.setUsername();break;case"message":t='<div style="background: #e1ffc7; margin-bottom: 10px; padding: 10px"><strong>'+e.id+"</strong> <br>"+e.text+'<span><span style="padding: 10px; float: right;">'+n+"</span></span></div>";break;case"rejectusername":d.username=e.name,console.log(`Your username has been set to <${e.name}> because the name you chose is in use`);break;case"userlist":d.userList=e.users;break;case"offer":console.log("Calling handleConnectionOffer from PeerConnection.onSignalingMessage"),yield d.handleConnectionOffer(e);break;case"answer":console.log("Calling handleConnectionAnswer from PeerConnection.onSignalingMessage"),yield d.handleConnectionAnswer(e);break;case"candidate":yield d.newICECandidate(e)}t.length&&(d.renderer.setProperty(d.publicChatBox.nativeElement,"innerHTML",d.publicChatBox.nativeElement.innerHTML+t),d.publicChatBox.nativeElement.scrollTop=d.publicChatBox.nativeElement.scrollHeight-d.publicChatBox.nativeElement.clientHeight)});return function(t){return e.apply(this,arguments)}}(),this.handleSendButton=e=>{const t={text:e,event:"message",id:this.clientID,room:this.loggedUser,date:Date.now()};this.signalingConnection.sendToServer(t),this.textBox.nativeElement.value=""},this.handleKey=e=>{13!==e.keyCode&&14!==e.keyCode||this.chatBoxDisabled||this.handleSendButton(this.textBox.nativeElement.value)},this.setUsername=()=>{this.username||(this.username=this.clientID)},this.newICECandidate=function(){var e=(0,r.Z)(function*(e){var t;try{const n=new RTCIceCandidate(e.candidate);yield null===(t=d.peerList.get(e.source))||void 0===t?void 0:t.addIceCandidate(n)}catch(n){}});return function(t){return e.apply(this,arguments)}}(),this.handleNegotiationNeededEvent=function(){var e=(0,r.Z)(function*(e,t,n,i){var s,r,o,a,c,l,h,g,u,p;try{d.makingOffer=!0,console.log("offer is created by caller: "+d.username+" to callee ---\x3e "+t+" state is --\x3e "+(null===(s=d.peerList.get(t))||void 0===s?void 0:s.signalingState)+" isnew --\x3e"+n+" streamf --\x3e "+i);const m=yield null===(r=d.peerList.get(t))||void 0===r?void 0:r.createOffer(e);if("stable"!==(null===(o=d.peerList.get(t))||void 0===o?void 0:o.signalingState)||i&&t===d.targetUsername)return void console.log("not stable! offer could not be created by : "+d.username+" to ---\x3e "+t+" state is --\x3e "+(null===(a=d.peerList.get(t))||void 0===a?void 0:a.signalingState)+" isnew --\x3e"+n+" streamf --\x3e "+i);if(m){m.sdp=null===(c=null==m?void 0:m.sdp)||void 0===c?void 0:c.replace(/(m=video.*\r\n)/g,`$1b=AS:${d.bandwidth}\r\n`),yield null===(l=d.peerList.get(t))||void 0===l?void 0:l.setLocalDescription(m);let s="";if(""!==n){const e=[];d.peerLStream.get(t)&&(null===(h=d.peerLStream.get(t))||void 0===h||h.forEach(t=>e.push(t))),d.peerRStream.get(d.targetUsername)&&(null===(g=d.peerRStream.get(d.targetUsername))||void 0===g||g.forEach(t=>{e.includes(t)||e.push(t)})),s=e.join(",")}else{if(s=d.clones[0].id,d.peerLStream.get(t)&&(null===(u=d.peerLStream.get(t))||void 0===u||u.forEach(e=>s+=","+e)),d.remoteStreamMap.forEach(e=>{var n;d.peerRStream.get(t)&&(null===(n=d.peerRStream.get(t))||void 0===n?void 0:n.includes(e.id))||(s+=","+e.id)}),d.targetUsername===t&&i)return void console.log(e+" offer could not be created by : "+d.username+" to ---\x3e "+t+" with streams --\x3e "+s);d.peerLStream.set(t,s.split(","))}console.log(e+" ---\x3e Creating offer by : "+d.username+" to ---\x3e "+t+" with streams --\x3e "+s+"merger: "+d.merger._streams.length),d.merger._streams.length>1&&(s="",d.merger._streams.forEach(e=>s+=e.id+",")),console.log("sendToServer an offer: ",s),d.signalingConnection.sendToServer({name:d.username,target:t,streams:s,polite:""!==n,event:"offer",sdp:null===(p=d.peerList.get(t))||void 0===p?void 0:p.localDescription})}}catch(m){console.error("offer creation error",m)}finally{console.log("offer creation finaled",t),d.makingOffer=!1}});return function(t,n,i,s){return e.apply(this,arguments)}}(),this.createPeerConnection=()=>{if(this.peerList.has(this.targetUsername)){const e=this.peerList.get(this.targetUsername);this.peerConnection=e||this.peerConnection}else this.peerConnection=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.peerList.set(this.targetUsername,this.peerConnection),this.peerConnection.onicecandidate=e=>this.handleICECandidateEvent(e),this.peerConnection.oniceconnectionstatechange=this.handleICEConnectionStateChangeEvent,this.peerConnection.onicegatheringstatechange=this.handleICEGatheringStateChangeEvent,this.peerConnection.onsignalingstatechange=this.handleSignalingStateChangeEvent,this.peerConnection.onnegotiationneeded=()=>this.handleNegotiationNeededEvent(this.offerOptions,this.targetUsername,this.isNew,this.yostream),this.peerConnection.ontrack=this.gotRemoteStream.bind(this)},this.setLocalStreams=function(){var e=(0,r.Z)(function*(e){var t,n;for(const i of d.merger.result.getTracks())e?(console.log("setLocalStreams at receivers: "+e),null===(n=d.peerList.get(d.targetUsername))||void 0===n||n.addTransceiver(i,{streams:[d.merger.result]})):(console.log("setLocalStreams at senders: "+e),null===(t=d.peerList.get(d.targetUsername))||void 0===t||t.addTrack(i,d.merger.result))});return function(t){return e.apply(this,arguments)}}(),this.gotRemoteStream=e=>{console.log("set RemoteStream by: "+this.username+" clones length: "+this.clones.length+"estreams length: "+e.streams.length),this.clones.some(t=>t.id===e.streams[0].id)||(console.log("gotRemoteStream merger.x: "+this.merger.width/(this.clones.length+1)),this.clones.push(e.streams[0]));const t=this.merger._streams.at(this.clones.length-1);t&&t.id===this.clones[this.clones.length-1].id||(this.merger.addStream(this.clones[this.clones.length-1],{x:this.merger.width/this.clones.length,y:this.merger.height/this.clones.length,width:this.merger.width,height:this.merger.height,mute:!1}),this.renderer.setProperty(this.remoteVideo.nativeElement,"srcObject",this.merger.result))},this.callUser=function(){var e=(0,r.Z)(function*(e){d.yostream=!1,d.targetUsername=e,console.log("peer list size --\x3e "+d.peerList.size),d.createPeerConnection(),d.createDataChannel(),yield d.setLocalStreams(!1)});return function(t){return e.apply(this,arguments)}}(),this.handleConnectionOffer=function(){var e=(0,r.Z)(function*(e){var t;console.log(" --Received video chat offer from caller: "+e.name+" by callee --\x3e "+e.target+" with streams --\x3e "+e.streams),d.targetUsername=e.name;let n=!1,i="";if(d.peerList.get(d.targetUsername)){if(d.peerLStream.has(d.targetUsername)){const e=d.peerLStream.get(d.targetUsername);e&&(i=e.join(","))}}else n=!0,d.createPeerConnection(),d.peerList.set(d.targetUsername,d.peerConnection),i=d.clones[0].id,d.remoteStreamMap.forEach(e=>{i+=","+e.id}),d.setDataChannel();if(console.log("signaling state at the start of offer response --\x3e "+(null===(t=d.peerList.get(d.targetUsername))||void 0===t?void 0:t.signalingState)),d.peerRStream.set(d.targetUsername,e.streams.split(",")),d.peerConnection){if("stable"!==d.peerConnection.signalingState){if(e.polite||d.makingOffer)return void console.log(" ---\x3e Answering offer by : "+d.username+" to ---\x3e "+d.targetUsername+"rejected by not polite");console.log(" ---\x3e Answering offer by : "+d.username+" to ---\x3e "+d.targetUsername+"offer called off by polite"),d.peerConnection&&function(...e){const t=e[e.length-1];"function"==typeof t&&e.pop(),(0,c.n)(e,void 0).lift(new u(t))}(d.peerConnection.setLocalDescription({type:"rollback"}),d.peerConnection.setRemoteDescription(new RTCSessionDescription(e.sdp)))}else yield d.peerConnection.setRemoteDescription(new RTCSessionDescription(e.sdp));if(n){console.log("handleConnectionOffer set streams: "+d.merger.width/(d.clones.length+1)),yield d.setLocalStreams(!0);const e=d.merger._streams.at(d.clones.length-1);e&&e.id!==d.clones[d.clones.length-1].id&&d.merger.addStream(d.clones[d.clones.length-1],{x:d.merger.width/d.clones.length,y:d.merger.height/d.clones.length,width:d.merger.width,height:d.merger.height,mute:!1})}!n&&d.checkMyPeers(d.targetUsername)&&(d.peerLStream.set(d.targetUsername,i.split(",")),d.peerList.size>1&&(console.log("While Answering to attempt feeding old friends with any of --\x3e "+e.streams),d.yostream=!1)),yield d.peerConnection.setLocalDescription(yield d.peerConnection.createAnswer(d.offerOptions).then(e=>{var t;return e.sdp=null===(t=null==e?void 0:e.sdp)||void 0===t?void 0:t.replace(/(m=video.*\r\n)/g,`$1b=AS:${d.bandwidth}\r\n`),e})),d.merger._streams.length>1&&(i="",d.merger._streams.forEach(e=>i+=e.id+",")),console.log("sendToServer an answer by --\x3e "+d.username+" to the offer from --\x3e "+d.targetUsername+" with streams --\x3e "+i),d.signalingConnection.sendToServer({name:d.username,target:d.targetUsername,streams:i,event:"answer",sdp:d.peerConnection.localDescription}),console.log("signaling state at the end of offer response --\x3e "+d.peerConnection.signalingState)}});return function(t){return e.apply(this,arguments)}}(),this.handleConnectionAnswer=function(){var e=(0,r.Z)(function*(e){var t,n;try{const i=d.peerList.get(e.name);if(i&&(yield i.setRemoteDescription(new RTCSessionDescription(e.sdp)).catch(e=>{console.log("Error in handleConnectionAnswer"),console.error(e)}),console.log("Answer from callee --\x3e "+e.name+" to the original caller --\x3e "+e.target+" entered with streams --\x3e "+e.streams),console.log("signaling state at the start of answer response --\x3e "+i.signalingState)),d.chatBoxDisabled=!1,e.name===d.targetUsername){let i;const s=d.peerRStream.get(e.name);i=s||[],e.streams.split(",").forEach(e=>{i.includes(e)||i.push(e)}),d.peerRStream.get(e.name)||d.peerRStream.set(e.name,i);const r=[];d.peerLStream.get(e.name)&&(null===(t=d.peerLStream.get(e.name))||void 0===t||t.forEach(e=>r.push(e))),d.peerRStream.get(d.targetUsername)&&(null===(n=d.peerRStream.get(d.targetUsername))||void 0===n||n.forEach(e=>{r.includes(e)||r.push(e)})),d.peerLStream.set(e.name,r)}}catch(i){console.error("::peer --\x3e "+e.name,i)}finally{console.log("caller/offerer has his own peers to feed --\x3e "+e.streams+" offerer --\x3e "+e.target+" answerer --\x3e "+e.name)}});return function(t){return e.apply(this,arguments)}}(),this.checkThyPeers=function(){var e=(0,r.Z)(function*(e,t){e===d.targetUsername&&d.checkMyPeers(e)&&(d.yostream=!0)});return function(t,n){return e.apply(this,arguments)}}(),this.checkMyPeers=e=>!(this.peerList.size>1)||[...this.peerList.keys()].filter(t=>t!==e).some(t=>{var n;return!this.peerLStream.get(t)||!this.peerRStream.get(e)||!(null===(n=this.peerRStream.get(e))||void 0===n?void 0:n.every(e=>{var n;return null===(n=this.peerLStream.get(t))||void 0===n?void 0:n.includes(e)}))}),this.handleRemoteStreams=function(){var e=(0,r.Z)(function*(e,t,n){var i,s;const r=d.remoteStreamMap.get(e);if(r&&(d.vidOff(r),d.remoteStreamMap.delete(e)),d.peerLStream.forEach((t,i)=>{const s=t.indexOf(e);-1!==s&&(t.splice(s),d.signalingConnection.sendToServer({name:d.username,streams:e,target:i,senders:n.join(","),event:"hang-up"}))}),""!==t){const n=null===(i=d.peerRStream.get(t))||void 0===i?void 0:i.indexOf(e);n&&-1!==n&&(null===(s=d.peerRStream.get(t))||void 0===s||s.splice(n))}});return function(t,n,i){return e.apply(this,arguments)}}(),this.closePeerCall=function(){var e=(0,r.Z)(function*(e,t,n){console.log("--\x3e Closing the peer connection");let i="";null!==e&&(d.peerList.forEach((t,n)=>{var s;t===e&&d.dataChannelList.get(n)&&(null===(s=d.dataChannelList.get(n))||void 0===s||s.close(),d.dataChannelList.delete(n),i=n)}),e.ontrack=null,e.onicecandidate=null,e.oniceconnectionstatechange=null,e.onsignalingstatechange=null,e.onicegatheringstatechange=null,e.onnegotiationneeded=null)});return function(t,n,i){return e.apply(this,arguments)}}(),this.closeAllVideoCall=(0,r.Z)(function*(){console.log("Closing the call");for(const e of d.peerList)yield d.closePeerCall(e,"","");d.targetUsername="",d.vidOff(d.localVideo.nativeElement.srcObject),d.localVideo.nativeElement.srcObject=null}),this.handleICECandidateEvent=e=>{e.candidate&&this.signalingConnection.sendToServer({event:"candidate",target:this.targetUsername,source:this.username,candidate:e.candidate})},this.handleICEConnectionStateChangeEvent=function(){var e=(0,r.Z)(function*(e){switch(console.log("ICEConnectionStateChange --\x3e "+d.peerConnection.iceConnectionState),d.peerConnection.iceConnectionState){case"closed":case"failed":case"disconnected":yield d.closePeerCall(d.peerConnection,"","")}});return function(t){return e.apply(this,arguments)}}(),this.handleSignalingStateChangeEvent=function(){var e=(0,r.Z)(function*(e){for(const t of d.peerList.values())console.log("SignalingStateChange --\x3e "+t.signalingState+" target --\x3e "+d.targetUsername+" senders count"+t.getSenders().length);switch(d.peerConnection.signalingState){case"closed":yield d.closePeerCall(d.peerConnection,"","")}});return function(t){return e.apply(this,arguments)}}(),this.handleICEGatheringStateChangeEvent=function(){var e=(0,r.Z)(function*(e){console.log("*** ICE gathering state changed to: "+d.peerConnection.iceGatheringState+e)});return function(t){return e.apply(this,arguments)}}(),this.sendData=e=>{var t;try{const n=new Date(Date.now()).toLocaleTimeString(),i='<div style="background: #e1ffc7; margin-bottom: 10px; padding: 10px"><strong>'+this.username+"</strong> <br>PRIVATE: "+this.textBox.nativeElement.value+'<span><span style="padding: 10px; float: right;">'+n+"</span></span></div>";this.renderer.setProperty(this.privateChatBox.nativeElement,"innerHTML",this.privateChatBox.nativeElement.innerHTML+'<div style="background: #e1ffc7; margin-bottom: 10px; padding: 10px"><strong>'+e+"</strong> <br>PRIVATE-ME: "+this.textBox.nativeElement.value+'<span><span style="padding: 10px; float: right;">'+n+"</span></span></div>"),null===(t=this.dataChannelList.get(e))||void 0===t||t.send(i)}catch(n){console.log("Error sending")}this.textBox.nativeElement.value=""},this.onDataChannelMessage=e=>{e.data.toString().startsWith("<div"),this.renderer.setProperty(this.privateChatBox.nativeElement,"innerHTML",this.privateChatBox.nativeElement.innerHTML+e.data),this.privateChatBox.nativeElement.scrollTop=this.privateChatBox.nativeElement.scrollHeight-this.privateChatBox.nativeElement.clientHeight},this.createDataChannel=()=>{this.dataChannel=this.peerConnection.createDataChannel(this.targetUsername,{ordered:!0,maxPacketLifeTime:5e3}),this.dataChannel.onclose=()=>{console.log("The Data Channel is Closed: ",this.dataChannel.label+"--"+this.dataChannel.id)},this.dataChannel.onerror=e=>{console.log("Data Channel Error:",e)},this.dataChannel.onmessage=this.onDataChannelMessage,this.dataChannelList.set(this.targetUsername,this.dataChannel)},this.scriptService.checkExists("2")||this.scriptService.injectScript(this.renderer,this._document,"https://webrtc.github.io/adapter/adapter-latest.js","script","2","","anonymous").then(e=>e),this.scriptService.checkExists("3")||this.scriptService.injectScript(this.renderer,this._document,"https://cdn.jsdelivr.net/npm/video-stream-merger@3.6.1/dist/video-stream-merger.min.js","script","3","","anonymous").then(e=>{this.merger=new VideoStreamMerger,this.merger.start()})}gotDevices(e){return e.filter(e=>"videoinput"===e.kind)}doSomething(){var e=this;return(0,r.Z)(function*(){yield e.closeAllVideoCall(),e.signalingConnection.connection.close()})()}vidOff(e){let t;null!=e&&(t=e.getTracks()),t&&t.forEach(function(e){e.stop()})}ngAfterViewInit(){this.speechService._supportRecognition||this._snackBar.open("Your Browser has no support for Speech!","Try Chrome for Speech!",{duration:3e3})}startCamera(){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(this.trace("Requesting local stream"),this.startButtonDisabled=!0,this.foods=(0,x.D)(navigator.mediaDevices.enumerateDevices().then(this.gotDevices)),navigator.mediaDevices.getUserMedia(this.constraints).then(this.attachVideo.bind(this)).catch(this.handleError)):alert("Sorry, camera not available.")}onSelectLanguage(e){this.currentLanguage=e,this.speechService.setLanguage(this.currentLanguage)}onSelectTargetLanguage(e){this.targetLanguage=e}capture(){this.renderer.setProperty(this.canvas.nativeElement,"width",this.videoWidth),this.renderer.setProperty(this.canvas.nativeElement,"height",this.videoHeight),this.canvas.nativeElement.getContext("2d").drawImage(this.localVideo.nativeElement,0,0)}handleError(e){console.log("Error: ",e)}onBookChange(e){this.constraints.video.facingMode="user"===this.constraints.video.facingMode?"environment":"user",console.log(e.value)}ngOnInit(){this.joinedUser=window.history.state?window.history.state.userID:"",this.loggedUser=window.history.state?window.history.state.loggedID:"",this.reactive.closeSources(),this.signalingConnection=new S("busra.nur:65080/ws",()=>this.startButtonDisabled=!1,this.onSignalingMessage,this.joinedUser,this.loggedUser),this.speechService.init(),this.speechService._supportRecognition&&(this.speechService.initializeSettings(this.currentLanguage),this.speechMessages=this.speechService.getMessage().pipe((0,b.U)(e=>(this.finalTranscript=e.transcript?e.transcript:"",e.transcript&&"final_transcript"===e.info&&(this.chatBoxDisabled=!1,this.speechService.translate({q:this.finalTranscript,target:this.targetLanguage,source:this.currentLanguage}).pipe((0,y.R)(this.onDestroy)).subscribe(e=>{this.handleSendButton(e)}),this.handleSendButton(this.finalTranscript)),e))))}attachVideo(e){if(console.log("attachVideo merger: "+this.merger.width,this.merger.height),this.localStream=e,this.clones.push(this.localStream.clone()),this.merger.addStream(this.clones[this.clones.length-1],{x:0,y:0,width:this.merger.width/(this.clones.length+1),height:this.merger.height/(this.clones.length+1),mute:!1}),this.renderer.setProperty(this.localVideo.nativeElement,"srcObject",this.merger.result),this.renderer.listen(this.localVideo.nativeElement,"play",()=>{this.videoHeight=this.localVideo.nativeElement.videoHeight,this.videoWidth=this.localVideo.nativeElement.videoWidth}),this.trace("Received local stream: "+this.clones[0].id),this.callButtonDisabled=!1,this.speechService._supportRecognition){if(this.recognizing)return void this.speechService.stop();this.speechService.startSpeech(e.startTime)}}ngOnDestroy(){this.onDestroy.next(),this.onDestroy.complete(),this.signalingConnection.connection.close(),null!=this.localVideo.nativeElement.srcObject&&(this.vidOff(this.localVideo.nativeElement.srcObject),this.localVideo.nativeElement.srcObject=null)}setDataChannel(){const e=this.peerList.get(this.targetUsername);e&&(e.ondatachannel=e=>{this.receiveChannel=e.channel,this.dataChannelList.set(this.targetUsername,this.receiveChannel),this.receiveChannel.onerror=e=>console.error("Data channel error",e),this.receiveChannel.onmessage=this.onDataChannelMessage,this.receiveChannel.onopen=()=>{console.log("Data channel open"),this.receiveChannel.send('<div style="color: chartreuse">Hello world!</div>')},this.receiveChannel.onclose=()=>console.log("Data channel closed: ",this.receiveChannel.label+"--"+this.receiveChannel.id)})}visualize(e){this.audioCtx||(this.audioCtx=new AudioContext);const t=this.audioCtx.createMediaStreamSource(e),n=this.audioCtx.createAnalyser();n.fftSize=2048;const i=n.frequencyBinCount,s=new Uint8Array(i);t.connect(n);const r=()=>{const e=this.soundCanvas.nativeElement.width,t=this.soundCanvas.nativeElement.height;requestAnimationFrame(r),n.getByteTimeDomainData(s),this.canvasCtx.fillStyle="rgb(200, 200, 200)",this.canvasCtx.fillRect(0,0,e,t),this.canvasCtx.lineWidth=2,this.canvasCtx.strokeStyle="rgb(0, 0, 0)",this.canvasCtx.beginPath();const o=1*e/i;let a=0;for(let n=0;n<i;n++){const e=s[n]/128*t/2;0===n?this.canvasCtx.moveTo(a,e):this.canvasCtx.lineTo(a,e),a+=o}this.canvasCtx.lineTo(this.soundCanvas.nativeElement.width,this.soundCanvas.nativeElement.height/2),this.canvasCtx.stroke()};r()}trace(e){const t=(window.performance.now()/1e3).toFixed(3);console.log(t+": ",e)}shiftPlace(e){}}return e.\u0275fac=function(t){return new(t||e)(w.Y36(L.r),w.Y36(w.Qsj),w.Y36(E.$),w.Y36(Z.v),w.Y36(w.R0b),w.Y36(T.ux),w.Y36(i.K0))},e.\u0275cmp=w.Xpm({type:e,selectors:[["app-camerad"]],viewQuery:function(e,t){if(1&e&&(w.Gf(U,7),w.Gf(A,7),w.Gf(D,7),w.Gf(B,7),w.Gf(q,7),w.Gf(P,7),w.Gf(I,7),w.Gf(N,7),w.Gf(H,7)),2&e){let e;w.iGM(e=w.CRH())&&(t.canvas=e.first),w.iGM(e=w.CRH())&&(t.soundCanvas=e.first),w.iGM(e=w.CRH())&&(t.startButton=e.first),w.iGM(e=w.CRH())&&(t.localVideo=e.first),w.iGM(e=w.CRH())&&(t.remoteVideo=e.first),w.iGM(e=w.CRH())&&(t.publicChatBox=e.first),w.iGM(e=w.CRH())&&(t.textBox=e.first),w.iGM(e=w.CRH())&&(t.privateChatBox=e.first),w.iGM(e=w.CRH())&&(t.speechTextBox=e.first)}},hostBindings:function(e,t){1&e&&w.NdJ("pagehide",function(e){return t.doSomething(e)},!1,w.Jf7)},decls:53,vars:19,consts:[[1,"container","vh-100"],[1,"d-flex","flex-column","align-items-center"],[2,"display","flex","justify-content","space-evenly","width","100%","margin-top","15px"],[1,"my-options"],["placeholder","Select your language",3,"ngModel","disabled","ngModelChange"],[3,"value","click",4,"ngFor","ngForOf"],["placeholder","Select target language",3,"ngModel","disabled","ngModelChange"],["required","",3,"formControl","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"p-1"],["playsinline","","autoplay","","muted","","controls",""],["localVideo",""],[1,"p-2",2,"padding-top","20px"],["playsinline","","autoplay","","controls",""],["remoteVideo",""],[2,"width","100%","padding","20px","display","flex","flex-direction","row","justify-content","space-between"],[2,"align-items","flex-start","padding","15px"],["id","micro",1,"btn","btn-primary",2,"max-height","44px","min-width","max-content",3,"disabled","click"],["startButton",""],[2,"padding-left","15px"],[1,"speech-result-width"],["matInput","","placeholder","Speech Input Result","disabled","true","cdkTextareaAutosize","","cdkAutosizeMinRows","2","cdkAutosizeMaxRows","5",3,"value"],["speechTextBox",""],[2,"align-items","flex-end","min-width","600px"],[2,"float","right"],[4,"ngFor","ngForOf"],["class","pb-2",4,"ngIf"],[1,"chat"],["id","textbox","type","text","name","text","placeholder","Say something meaningful...","autocomplete","off","cdkTextareaAutosize","","cdkAutosizeMinRows","2","cdkAutosizeMaxRows","5",3,"disabled","keyup"],["textBox",""],["type","button","id","send","name","send","value","Send",1,"btn","btn-primary",2,"vertical-align","text-bottom",3,"disabled","click"],["sendChat",""],[2,"height","auto","max-height","400px","width","800px","max-width","800px","display","flex","flex-direction","column","margin-bottom","200px"],[2,"flex-grow","1","padding","20px 30px","overflow","auto"],[1,"privateChatBox",2,"display","flex","flex-direction","column","align-items","flex-start"],["privateChatBox",""],[1,"publicChatBox",2,"display","flex","flex-direction","column","align-items","flex-end"],["publicChatBox",""],[3,"value","click"],[3,"value"],[1,"btn","btn-primary",2,"border-width","2px","border-color","greenyellow",3,"click"],[1,"pb-2"],[1,"btn","btn-primary",3,"click"]],template:function(e,t){if(1&e){const e=w.EpF();w.TgZ(0,"div",0),w.TgZ(1,"div",1),w.TgZ(2,"div",2),w.TgZ(3,"mat-form-field",3),w.TgZ(4,"mat-select",4),w.NdJ("ngModelChange",function(e){return t.currentLanguage=e}),w.YNc(5,j,2,2,"mat-option",5),w.qZA(),w.qZA(),w.TgZ(6,"mat-form-field",3),w.TgZ(7,"mat-select",6),w.NdJ("ngModelChange",function(e){return t.targetLanguage=e}),w.YNc(8,z,2,2,"mat-option",5),w.qZA(),w.qZA(),w.TgZ(9,"mat-form-field",3),w.TgZ(10,"mat-label"),w._uU(11,"Choose Cam"),w.qZA(),w.TgZ(12,"mat-select",7),w.NdJ("selectionChange",function(e){return t.onBookChange(e)}),w.YNc(13,J,2,2,"mat-option",8),w.ALo(14,"async"),w.qZA(),w.TgZ(15,"mat-hint"),w._uU(16),w.qZA(),w.qZA(),w.qZA(),w.TgZ(17,"div",9),w._UZ(18,"video",10,11),w.qZA(),w.TgZ(20,"div",12),w._UZ(21,"video",13,14),w.qZA(),w.TgZ(23,"div",15),w.TgZ(24,"div",16),w.TgZ(25,"button",17,18),w.NdJ("click",function(){return t.startCamera()}),w._uU(27,"Start Webcam"),w.qZA(),w.qZA(),w.TgZ(28,"div",19),w.TgZ(29,"form"),w.TgZ(30,"mat-form-field",20),w.TgZ(31,"mat-label"),w._uU(32,"Speech Input Result"),w.qZA(),w._UZ(33,"textarea",21,22),w.ALo(35,"async"),w.qZA(),w.qZA(),w.qZA(),w.TgZ(36,"div",23),w.TgZ(37,"ul",24),w.YNc(38,V,9,1,"li",25),w.qZA(),w.qZA(),w.qZA(),w.YNc(39,F,3,0,"div",26),w.TgZ(40,"div",27),w._uU(41," Chat:"),w._UZ(42,"br"),w.TgZ(43,"textarea",28,29),w.NdJ("keyup",function(e){return t.handleKey(e)}),w.qZA(),w.TgZ(45,"input",30,31),w.NdJ("click",function(){w.CHM(e);const n=w.MAs(44);return t.handleSendButton(n.value)}),w.qZA(),w.qZA(),w.TgZ(47,"div",32),w.TgZ(48,"div",33),w._UZ(49,"div",34,35),w._UZ(51,"div",36,37),w.qZA(),w.qZA(),w.qZA(),w.qZA()}if(2&e){let e;w.xp6(4),w.Q6J("ngModel",t.currentLanguage)("disabled",t.recognizing),w.xp6(1),w.Q6J("ngForOf",t.languages),w.xp6(2),w.Q6J("ngModel",t.targetLanguage)("disabled",t.recognizing),w.xp6(1),w.Q6J("ngForOf",t.languages),w.xp6(4),w.Q6J("formControl",t.animalControl),w.xp6(1),w.Q6J("ngForOf",w.lcZ(14,15,t.foods)),w.xp6(3),w.Oqu(null==t.animalControl.value?null:t.animalControl.value.deviceId),w.xp6(9),w.Q6J("disabled",t.startButtonDisabled),w.xp6(8),w.Q6J("value",null==(e=w.lcZ(35,17,t.speechMessages))?null:e.transcript),w.xp6(5),w.Q6J("ngForOf",t.userList),w.xp6(1),w.Q6J("ngIf",t.peerList.size>0),w.xp6(4),w.Q6J("disabled",!1),w.xp6(2),w.Q6J("disabled",t.chatBoxDisabled)}},directives:[_.KE,M.gD,C.JJ,C.On,i.sg,_.hX,C.Q7,C.oH,_.bx,C._Y,C.JL,C.F,O.Nt,R.IC,i.O5,k.ey],pipes:[i.Ov],styles:["video[_ngcontent-%COMP%]{width:100%}.p-1[_ngcontent-%COMP%]{display:flex}mat-form-field.my_options[_ngcontent-%COMP%]{max-width:33%}mat-form-field.speech-result-width[_ngcontent-%COMP%]{width:auto;min-width:300px;text-align:center}li[_ngcontent-%COMP%], ul[_ngcontent-%COMP%]{list-style-type:none}li[_ngcontent-%COMP%]{text-indent:-2em}.chat[_ngcontent-%COMP%]{min-width:400px}#textbox[_ngcontent-%COMP%]{min-width:380px}#micro[_ngcontent-%COMP%]{color:#fff;background-color:#007bff;border:1px solid #0000;padding:.375rem .75rem;border-radius:.25rem;font-family:inherit;font-weight:400;font-size:17px;height:auto;width:159px;cursor:pointer}"]}),e})(),Q=(()=>{class e{constructor(e,t){this.router=e,this._snackBar=t,this.message="You are redirected to Home",this.action="Please Login & Try Again"}canActivate(e,t){var n,i;const s=null===(i=null===(n=this.router.getCurrentNavigation())||void 0===n?void 0:n.extras)||void 0===i?void 0:i.state;return s&&(this.user=s.userID,this.room=s.loggedID),this.room&&this.user||(this._snackBar.open(this.message,this.action,{duration:3e3}),this.router.navigate(["/"])),!0}}return e.\u0275fac=function(t){return new(t||e)(w.LFG(s.F0),w.LFG(T.ux))},e.\u0275prov=w.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Y=[{path:"",component:G,canActivate:[Q]}];let $=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=w.oAB({type:e,bootstrap:[G]}),e.\u0275inj=w.cJS({providers:[Q],imports:[[i.ez,s.Bz.forChild(Y),C.u5,C.UX,M.LD,O.c,T.ZX,R.Ky],i.ez]}),e})()},7444:(e,t,n)=>{"use strict";n.d(t,{v:()=>d});var i=n(2693),s=n(8512),r=n(5366);const{webkitSpeechRecognition:o,mozSpeechRecognition:a,SpeechRecognition:c,msSpeechRecognition:l}=window;var h=function(e){return e[e.NO_SPEECH=0]="NO_SPEECH",e[e.NO_MICROPHONE=1]="NO_MICROPHONE",e[e.NOT_ALLOWED=2]="NOT_ALLOWED",e[e.BLOCKED=3]="BLOCKED",e}({});let d=(()=>{class e{constructor(e,t){this.zone=e,this.http=t,this.speechSubject=new s.X({transcript:"",info:"begin"}),this.texts=new Map,this._mitext="",this.translate=e=>{let t=new i.LE;return t=t.append("q",e.q),t=t.append("target",e.target),t=t.append("source",e.source),t=t.append("callback","?"),this.http.get("https://script.google.com/macros/s/AKfycbweT9Vi_HhKzrLB8yMx29oFQlsPHHPYcJ68LMojN_elqlO_QUrT/exec",{params:t})},this.say=e=>{this.utterance.lang=e.lang,this.utterance.text=e.text,window.speechSynthesis.speak(this.utterance)}}init(){this._supportRecognition=!0,window.SpeechRecognition?this._speech=new c:window.webkitSpeechRecognition?this._speech=new o:window.msSpeechRecognition?this._speech=new l:window.mozSpeechRecognition?this._speech=new a:this._supportRecognition=!1,this.utterance=new SpeechSynthesisUtterance,console.log(`Speech supported: ${this._supportRecognition}`)}startSpeech(e){this.startTimestamp=e,this._speech.start()}setLanguage(e){this._speech.lang=e}initializeSettings(e){this._speech.continuous=!0,this._speech.interimResults=!0,this._speech.lang=e,this.initListeners()}set mitext(e){this._mitext=e}get mitext(){return this._mitext}initListeners(){this._speech.onstart=e=>{this.zone.run(()=>this.speechSubject.next({transcript:"speak now!",info:"start"}))},this._speech.onspeechend=()=>{this.stop(),console.log("Speech recognition has stopped.")},this._speech.onend=e=>{this.ignoreOnEnd||this.zone.run(()=>{this.speechSubject.next({transcript:this._mitext,info:"print"})})},this._speech.onerror=e=>{let t;"no-speech"===e.error&&(t=h.NO_SPEECH,this.ignoreOnEnd=!0),"audio-capture"===e.error&&(t=h.NO_MICROPHONE,this.ignoreOnEnd=!0),"not-allowed"===e.error&&(t=e.timeStamp-this.startTimestamp<100?h.BLOCKED:h.NOT_ALLOWED,this.ignoreOnEnd=!0),this.zone.run(()=>this.speechSubject.next({error:t}))},this._speech.onresult=e=>{let t="",n="";for(let i=e.resultIndex;i<e.results.length;++i)e.results[i].isFinal?n+=e.results[i][0].transcript:t+=e.results[i][0].transcript;this.zone.run(()=>{n&&this.speechSubject.next({info:"final_transcript",transcript:n}),t&&this.speechSubject.next({info:"interim_transcript",transcript:t})})}}stop(){this._speech.stop()}abort(){this._speech.abort(),this.mitext=""}getMessage(){return this.speechSubject.asObservable()}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(r.R0b),r.LFG(i.eN))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},6304:(e,t,n)=>{"use strict";function i(e,t,n,i,s,r,o){try{var a=e[r](o),c=a.value}catch(l){return void n(l)}a.done?t(c):Promise.resolve(c).then(i,s)}function s(e){return function(){var t=this,n=arguments;return new Promise(function(s,r){var o=e.apply(t,n);function a(e){i(o,s,r,a,c,"next",e)}function c(e){i(o,s,r,a,c,"throw",e)}a(void 0)})}}n.d(t,{Z:()=>s})}}]);